---
- name: Test
  hosts: all
  vars:
    xdg_config_home: "~/.config"
    items:
      - "src/one"
      - "src/two"
      - src: "foo/bar"
        dest: "baz"

  tasks:
    - name: Parse into items_dict.
      ansible.builtin.set_fact:
        items_dict_list: "{{
          items_dict_list | default([])
          + [{
              'src': item.src | default(item),
              'dest': ([item.dest | default(omit), item.src | default(item) | basename] | reject('equalto', omit) | join('/'))
            }]
          }}"
      loop: "{{ items }}"

    - name: Parse values into json.
      ansible.builtin.debug:
        msg: "{{ items_dict_list | to_yaml }}"


